#!/data/data/com.termux/files/usr/bin/bash

SITE="/storage/emulated/0/BIZHOST"
TMP="/data/data/com.termux/files/usr/tmp/bizhostlink.log"

# ===== BOOT =====
clear
echo -e "\e[1;32mBooting BIZHOST OS...\e[0m"
for i in {1..30}; do printf "█"; sleep 0.03; done
sleep 0.5
echo ""
echo -e "\e[1;36mInitializing secure modules...\e[0m"
sleep 0.5
echo -e "\e[1;31mSecurity layer active\e[0m"
sleep 0.5
echo -e "\e[1;32mSystem ready\e[0m"
sleep 1

while true
do
clear

# ===== HEADER =====
echo -e "\e[1;32m██████╗ ██╗███████╗██╗  ██╗ ██████╗ ███████╗████████╗"
echo "██╔══██╗██║╚══███╔╝██║  ██║██╔═══██╗██╔════╝╚══██╔══╝"
echo "██████╔╝██║  ███╔╝ ███████║██║   ██║███████╗   ██║   "
echo "██╔══██╗██║ ███╔╝  ██╔══██║██║   ██║╚════██║   ██║   "
echo "██████╔╝██║███████╗██║  ██║╚██████╔╝███████║   ██║   "
echo "╚═════╝ ╚═╝╚══════╝╚═╝  ╚═╝ ╚═════╝ ╚══════╝   ╚═╝   "
echo -e "\e[0m"

echo -e "\e[1;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\e[0m"
echo -e "\e[1;36m  BIZ HOSTING  — ONLINE\e[0m"
echo -e "\e[1;31m  SECURITY LEVEL : MAXIMUM\e[0m"
echo -e "\e[1;37m  USER           : $(whoami)\e[0m"
echo -e "\e[1;33m  ROOT DIR       : $SITE\e[0m"
echo -e "\e[1;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\e[0m"
echo ""

# ===== MENU =====
echo "[ 1 ] Start Server (localhost:8080)"
echo "[ 2 ] Create Public Link"
echo "[ 3 ] Open Site Folder"
echo "[ 4 ] Stop Server"
echo "[ X ] Exit"
echo ""

read -p "BIZHOST > " opt

case $opt in

# ===== START SERVER =====
1)
clear
echo -e "\e[1;32m━━━━━━━━ SERVER STATUS ━━━━━━━━\e[0m"
echo -e "\e[1;36mPHP SERVER INITIALIZED\e[0m"
echo -e "\e[1;37mAddress : http://localhost:8080\e[0m"
echo -e "\e[1;33mRoot    : $SITE\e[0m"
echo -e "\e[1;32m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\e[0m"
echo ""
php -S 0.0.0.0:8080 -t "$SITE"
;;

# ===== PUBLIC LINK =====
2)
clear
echo -e "\e[1;32m━━━━━━━━ PUBLIC ACCESS ━━━━━━━━\e[0m"
echo -e "\e[1;36mGenerating secure tunnel...\e[0m"
echo ""

rm -f "$TMP"

cloudflared tunnel --url http://localhost:8080 > "$TMP" 2>&1 &

sleep 7

LINK=$(grep -o 'https://[-a-zA-Z0-9\.]*trycloudflare.com' "$TMP" | head -n 1)

clear
echo -e "\e[1;32m━━━━━━━━ PUBLIC ACCESS ━━━━━━━━\e[0m"

if [ -n "$LINK" ]; then
    echo -e "\e[1;36mSTATUS : ACTIVE\e[0m"
    echo -e "\e[1;37mLocal  : http://localhost:8080\e[0m"
    echo -e "\e[1;33mPublic : $LINK\e[0m"
else
    echo -e "\e[1;31mSTATUS : FAILED\e[0m"
    echo -e "\e[1;37mMake sure server is running\e[0m"
fi

echo -e "\e[1;32m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\e[0m"
echo ""
echo "Press CTRL + C to stop public link"

tail -f /dev/null
;;

# ===== OPEN FOLDER =====
3)
clear
echo -e "\e[1;36mOpening site directory...\e[0m"
cd "$SITE"
bash
;;

# ===== STOP SERVER =====
4)
clear
pkill php
echo -e "\e[1;32m━━━━━━━━ SERVER STOPPED ━━━━━━━━\e[0m"
echo -e "\e[1;36mPHP server terminated\e[0m"
echo -e "\e[1;32m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\e[0m"
sleep 2
;;

x|X)
exit
;;

*)
echo "Invalid option"
sleep 1
;;

esac

done
